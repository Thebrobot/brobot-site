import{M as A,j as P,a as z,u as S,P as D,b as K,c as U,L as B}from"./proxy.PCqCjbNd.js";import{r as s}from"./index.DiEladB3.js";function I(e,r){if(typeof e=="function")return e(r);e!=null&&(e.current=r)}function F(...e){return r=>{let t=!1;const o=e.map(u=>{const c=I(u,r);return!t&&typeof c=="function"&&(t=!0),c});if(t)return()=>{for(let u=0;u<o.length;u++){const c=o[u];typeof c=="function"?c():I(e[u],null)}}}}function G(...e){return s.useCallback(F(...e),e)}class V extends s.Component{getSnapshotBeforeUpdate(r){const t=this.props.childRef.current;if(t&&r.isPresent&&!this.props.isPresent){const o=t.offsetParent,u=z(o)&&o.offsetWidth||0,c=z(o)&&o.offsetHeight||0,n=this.props.sizeRef.current;n.height=t.offsetHeight||0,n.width=t.offsetWidth||0,n.top=t.offsetTop,n.left=t.offsetLeft,n.right=u-n.width-n.left,n.bottom=c-n.height-n.top}return null}componentDidUpdate(){}render(){return this.props.children}}function X({children:e,isPresent:r,anchorX:t,anchorY:o,root:u}){const c=s.useId(),n=s.useRef(null),g=s.useRef({width:0,height:0,top:0,left:0,right:0,bottom:0}),{nonce:R}=s.useContext(A),w=e.props?.ref??e?.ref,l=G(n,w);return s.useInsertionEffect(()=>{const{width:y,height:f,top:a,left:p,right:m,bottom:C}=g.current;if(r||!n.current||!y||!f)return;const M=t==="left"?`left: ${p}`:`right: ${m}`,b=o==="bottom"?`bottom: ${C}`:`top: ${a}`;n.current.dataset.motionPopId=c;const x=document.createElement("style");R&&(x.nonce=R);const d=u??document.head;return d.appendChild(x),x.sheet&&x.sheet.insertRule(`
          [data-motion-pop-id="${c}"] {
            position: absolute !important;
            width: ${y}px !important;
            height: ${f}px !important;
            ${M}px !important;
            ${b}px !important;
          }
        `),()=>{d.contains(x)&&d.removeChild(x)}},[r]),P.jsx(V,{isPresent:r,childRef:n,sizeRef:g,children:s.cloneElement(e,{ref:l})})}const Y=({children:e,initial:r,isPresent:t,onExitComplete:o,custom:u,presenceAffectsLayout:c,mode:n,anchorX:g,anchorY:R,root:w})=>{const l=S(_),y=s.useId();let f=!0,a=s.useMemo(()=>(f=!1,{id:y,initial:r,isPresent:t,custom:u,onExitComplete:p=>{l.set(p,!0);for(const m of l.values())if(!m)return;o&&o()},register:p=>(l.set(p,!1),()=>l.delete(p))}),[t,l,o]);return c&&f&&(a={...a}),s.useMemo(()=>{l.forEach((p,m)=>l.set(m,!1))},[t]),s.useEffect(()=>{!t&&!l.size&&o&&o()},[t]),n==="popLayout"&&(e=P.jsx(X,{isPresent:t,anchorX:g,anchorY:R,root:w,children:e})),P.jsx(D.Provider,{value:a,children:e})};function _(){return new Map}const $=e=>e.key||"";function H(e){const r=[];return s.Children.forEach(e,t=>{s.isValidElement(t)&&r.push(t)}),r}const N=({children:e,custom:r,initial:t=!0,onExitComplete:o,presenceAffectsLayout:u=!0,mode:c="sync",propagate:n=!1,anchorX:g="left",anchorY:R="top",root:w})=>{const[l,y]=K(n),f=s.useMemo(()=>H(e),[e]),a=n&&!l?[]:f.map($),p=s.useRef(!0),m=s.useRef(f),C=S(()=>new Map),M=s.useRef(new Set),[b,x]=s.useState(f),[d,L]=s.useState(f);U(()=>{p.current=!1,m.current=f;for(let h=0;h<d.length;h++){const i=$(d[h]);a.includes(i)?(C.delete(i),M.current.delete(i)):C.get(i)!==!0&&C.set(i,!1)}},[d,a.length,a.join("-")]);const j=[];if(f!==b){let h=[...f];for(let i=0;i<d.length;i++){const E=d[i],v=$(E);a.includes(v)||(h.splice(i,0,E),j.push(E))}return c==="wait"&&j.length&&(h=j),L(H(h)),x(f),null}const{forceRender:T}=s.useContext(B);return P.jsx(P.Fragment,{children:d.map(h=>{const i=$(h),E=n&&!l?!1:f===d||a.includes(i),v=()=>{if(M.current.has(i))return;if(M.current.add(i),C.has(i))C.set(i,!0);else return;let k=!0;C.forEach(W=>{W||(k=!1)}),k&&(T?.(),L(m.current),n&&y?.(),o&&o())};return P.jsx(Y,{isPresent:E,initial:!p.current||t?void 0:!1,custom:r,presenceAffectsLayout:u,mode:c,root:w,onExitComplete:E?void 0:v,anchorX:g,anchorY:R,children:h},i)})})};export{N as A};
